<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.staticfile.net/echarts/4.3.0/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdn.socket.io/4.3.0/socket.io.min.js"></script>
    <link rel="stylesheet" href="./fonts/remixicon.css">
    <link rel="stylesheet" href="../static/fonts/remixicon.css">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
    <title>老人监护系统</title>
    <style>
        :root {
            --primary-color: #6AB3D6;
            /* 全息蓝（主色） */
            --secondary-color: #8EC7E0;
            /* 荧光蓝 */
            --accent-color: rgb(255, 155, 210);
            /* 全息粉（交互色） */
            --background-color: rgb(245, 248, 255);
            /* 光晕白 */
            --text-color: rgb(30, 45, 70);
            /* 深空蓝 */
            --border-color: rgba(200, 215, 235, 0.6);
            /* 光晕边缘 */
            --success-color: rgb(165, 235, 180);
            /* 荧光绿 */
            --warning-color: rgb(255, 225, 125);
            /* 能量黄 */
            --danger-color: rgb(255, 115, 150);
            /* 警报粉 */
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --hover-scale: scale(1.02);
            --hover-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* 自定义滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(200, 215, 235, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
            transition: var(--transition);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* 针对Firefox的滚动条样式 */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) rgba(200, 215, 235, 0.1);
        }

        body,
        html {
            height: 100%;
            width: 100%;
            margin: 0;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f7fa;
            color: var(--text-color);
            font-size: 16px;
            /* 增加基础字体大小 */
        }

        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 30px;
            box-shadow: var(--box-shadow);
            position: relative;
            z-index: 100;
            animation: fadeIn 0.5s ease-out;
        }

        #header h2 {
            margin: 0;
            font-size: 28px;
            /* 增加标题字体大小 */
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #header .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #header .user-info img {
            border-radius: 50%;
            width: 45px;
            height: 45px;
            border: 2px solid white;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        #header .user-info img:hover {
            transform: rotate(5deg) scale(1.1);
            box-shadow: var(--hover-shadow);
        }

        #header .user-info .dropdown {
            position: relative;
            cursor: pointer;
        }

        #header .user-info .dropdown-content {
            position: absolute;
            right: 0;
            top: 100%;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 15px;
            min-width: 150px;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        #header .user-info .dropdown:hover .dropdown-content {
            opacity: 1;
            visibility: visible;
            transform: translateY(5px);
        }

        #header .user-info .dropdown-content a {
            display: block;
            padding: 8px 0;
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
        }

        #header .user-info .dropdown-content a:hover {
            color: var(--primary-color);
        }

        #top_window {
            display: flex;
            height: calc(100% - 75px);
            gap: 20px;
            padding: 20px;
        }

        #label_window {
            z-index: 0;
            width: 5vw;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            transition: var(--transition);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7)); */
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        #label_window.active {
            width: 250px;
        }

        #label_window.active .func_label {
            width: 100%;
            justify-content: flex-start;
        }

        #label_window:not(.active) .func_label {
            width: 100%;
            justify-content: center;
        }

        #label_window:not(.active) .func_label span {
            display: none;
        }

        #label_window.active .func_label span {
            display: inline;
            opacity: 1;
            transform: translateX(0);
        }

        .func_label {
            width: 3vw;
            margin-right: 1vw;
            margin-left: 1vw;
            display: flex;
            align-items: center;
            padding: 15px;
            margin-top: 40px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-color);
            white-space: nowrap;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(106, 179, 214, 0.2);
            animation: slideIn 0.5s ease-out;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .func_label:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 4px 12px rgba(106, 179, 214, 0.3);
        }

        .func_label:hover .func_icon {
            filter: brightness(1.2);
            transform: scale(1.1) rotate(5deg);
        }

        .func_label.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 12px rgba(106, 179, 214, 0.3);
            transform: translateX(5px);
        }

        .func_label.active .func_icon {
            filter: brightness(1.2);
            transform: scale(1.1);
        }

        .func_label::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            transform: scaleY(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .func_label:hover::before,
        .func_label.active::before {
            transform: scaleY(1);
        }

        .func_icon {
            width: 24px;
            height: 24px;
            min-width: 24px;
            filter: brightness(0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-right: 10px;
        }

        #main_window {
            z-index: 0;
            flex: 1;
            /* background-color: var(--background-color); */
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            overflow-y: auto;
            border: 0px solid var(--border-color);
        }

        .func_window {
            display: none;
            animation: fadeIn 0.5s ease-out;
            background: rgba(255, 255, 255, 0);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }

        .func_window h2 {
            font-size: 1.5vw;
            color: var(--text-color);
            margin-bottom: 2vh;
            padding-bottom: 1vh;
            position: relative;
            display: flex;
            align-items: center;
            gap: 1vw;
        }

        .func_window h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right,
                    var(--primary-color) 0%,
                    var(--secondary-color) 50%,
                    var(--primary-color) 100%);
        }

        .func_icon {
            width: 2vw;
            height: 2vw;
            object-fit: contain;
        }

        .func_window.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 5px var(--primary-color);
            }

            50% {
                box-shadow: 0 0 20px var(--primary-color);
            }

            100% {
                box-shadow: 0 0 5px var(--primary-color);
            }
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            /* 增加按钮字体大小 */
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .delete-medicine {
            background-color: var(--danger-color);
        }

        .delete-medicine:hover {
            background-color: var(--danger-color);
            opacity: 0.9;
        }

        /* 修改按钮样式 */
        .edit-button {
            display: inline-flex;
            /* 改为行内弹性容器，避免宽度撑满 */
            align-items: center;
            justify-content: center;
            /* 新增水平居中 */
            gap: 4px;
            height: 3vh;
            /* 固定高度 */
            padding: 0 12px;
            /* 去除上下 padding */
            background-color: transparent;
            color: #faad14;
            border: 1px solid #faad14;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
            line-height: 1;
            margin-left: 1vw;
            /* 防止文字被拉伸 */
        }

        .edit-button i {
            font-size: 14px;
        }

        .edit-button:hover {
            background-color: #faad14;
            color: white;
            transform: translateY(-1px);
        }

        .edit-button:active {
            transform: translateY(0);
        }

        .edit-button.save {
            background-color: var(--success-color);
            color: white;
            border: none;
        }

        .edit-button.save:hover {
            background-color: var(--success-color);
            opacity: 0.9;
        }

        .save-button {
            background-color: var(--success-color);
            color: white;
            border: none;
            /* padding: 4px 8px;
            font-size: 12px;
            margin-left: 8px; */
            margin-right: 1vw;
        }

        .save-button:hover {
            background-color: var(--success-color);
            opacity: 0.9;
            transform: none;
            animation: glow 2s infinite;
        }

        input[type="text"],
        input[type="date"],
        input[type="time"],
        select,
        textarea {
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            transition: var(--transition);
            background-color: white;
            color: var(--text-color);
            font-size: 14px;
            width: 100%;
            box-sizing: border-box;
            margin: 5px 0;
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(106, 179, 214, 0.2);
        }

        input[type="text"]:hover,
        input[type="date"]:hover,
        input[type="time"]:hover,
        select:hover,
        textarea:hover {
            border-color: var(--secondary-color);
        }

        /* 自定义日期选择器样式 */
        input[type="date"]::-webkit-calendar-picker-indicator {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236AB3D6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

        input[type="date"]::-webkit-calendar-picker-indicator:hover {
            background-color: rgba(106, 179, 214, 0.1);
        }

        /* 自定义时间选择器样式 */
        input[type="time"]::-webkit-calendar-picker-indicator {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236AB3D6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 6 12 12 16 14'%3E%3C/polyline%3E%3C/svg%3E");
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

        input[type="time"]::-webkit-calendar-picker-indicator:hover {
            background-color: rgba(106, 179, 214, 0.1);
        }

        /* 自定义下拉选择框样式 */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236AB3D6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 40px;
        }

        select:hover {
            background-color: rgba(106, 179, 214, 0.05);
        }

        /* 文本域样式 */
        textarea {
            min-height: 100px;
            resize: vertical;
            line-height: 1.5;
        }

        textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(106, 179, 214, 0.2);
        }

        /* 输入框组样式 */
        .time-group,
        .period-settings,
        .special-notes {
            margin: 15px 0;
            padding: 10px;
            background-color: rgba(245, 248, 255, 0.5);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .time-group:hover,
        .period-settings:hover,
        .special-notes:hover {
            background-color: rgba(245, 248, 255, 0.8);
        }

        .time-group label,
        .period-settings label,
        .special-notes label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 500;
        }

        /* 时间选择器组样式 */
        .time-pickers {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .time-pickers input[type="time"] {
            flex: 1;
            min-width: 150px;
        }

        /* 日期范围选择器样式 */
        .period {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .period input[type="date"] {
            flex: 1;
        }

        .period span {
            color: var(--text-color);
            font-weight: 500;
        }

        .medicine-item {
            background: white;
            border-radius: var(--border-radius);
            margin: 20px 0;
            padding: 0;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.5s ease-out;
            overflow: hidden;
        }

        .medicine-item:hover {
            transform: var(--hover-scale);
            box-shadow: var(--hover-shadow);
        }

        .preview-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: var(--border-radius);
            border: 2px solid #ddd;
            transition: var(--transition);
        }

        .preview-image:hover {
            transform: scale(1.05);
            box-shadow: var(--hover-shadow);
        }

        .upload-container {
            position: relative;
            display: inline-block;
            margin: 10px;
        }

        .upload-container:hover .preview-image {
            opacity: 0.8;
        }

        .pic-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }

        .status-records {
            max-height: 600px;
            overflow-y: auto;
            padding: 15px;
            font-size: 1vw;
        }

        .record {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            animation: slideIn 0.5s ease-out;
        }

        .record:hover {
            transform: translateX(5px);
            box-shadow: var(--hover-shadow);
        }

        .snapshot-btn {
            background-color: var(--secondary-color);
            color: white;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .snapshot-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        #camera_camera {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        #camera_camera img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-button {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        #camera_button {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #camera_button input[type="button"] {
            width: 150px;
            padding: 12px;
            font-size: 16px;
        }

        .camera_open {
            background-color: var(--secondary-color);
        }

        .camera_close {
            background-color: var(--danger-color);
        }

        /* 设备信息 */
        .circle {
            fill: none;
            stroke: #7C83FD;
            stroke-width: 12;
            stroke-dasharray: 628;
            stroke-dashoffset: 628;
            /* animation: circle 3s infinite; */
            transform: rotate(-90deg);
            transform-origin: center;
            transform-box: fill-box;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);

        }

        #circle1 {
            position: absolute;
            top: 50%;
            left: 50%;
        }

        #circle_percent {
            font-size: 20px;
        }

        .percent {
            font-size: 20px;
        }

        @keyframes circle {
            100% {
                stroke-dashoffset: 0;
            }
        }

        #mem_circle {
            position: relative;
            height: 220px;
            width: 220px;
            display: grid;
            margin: 0 auto;
        }

        #circle1_svg {
            height: 220px;
            width: 220px;
        }

        #circle1_data {
            height: 40px;
            text-align: center;
        }

        #cpu_circle {
            position: relative;
            height: 220px;
            width: 220px;
            display: grid;
            grid-auto-rows: min-content;
            margin: 0 auto;
        }

        #circle2_svg {
            height: 220px;
            width: 220px;
        }

        #circle2_data {
            height: 40px;
            text-align: center;
        }

        #server_data_cpu12 {
            margin-top: 20px;
            position: relative;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        #server_data_cpu34 {
            position: relative;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        #server_data_all {
            display: grid;
            gap: 20px;
            padding: 20px;
        }

        .text {
            font-size: 20px;
            position: relative;
        }

        #circle_percent {
            height: 40px;
        }

        #circle2_percent {
            height: 40px;
        }

        #circle_all {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
            padding: 20px;
        }

        #CPU1,
        #CPU2,
        #CPU3,
        #CPU4 {
            height: 25vh;
            width: 30vw;
            /* min-width: 300px; */
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px;
        }

        #circle1_data_label,
        #circle2_data_label {
            text-align: center;
            font-size: 16px;
            margin-bottom: 10px;
        }

        /* ----------------------事件建议----------------------------- */
        .chat-container {
            position: relative;
            left: 250px;
            width: 80%;
            max-width: 600px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .chat-history {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            border-bottom: 1px solid #ddd;
        }

        .chat-entry {
            display: flex;
            margin-bottom: 15px;
        }

        .chat-entry.user {
            justify-content: flex-end;
        }

        .chat-entry.ai {
            justify-content: flex-start;
        }

        .chat-bubble {
            max-width: 70%;
            padding: 10px;
            border-radius: 5px;
            background-color: #f1f1f1;
            transition: var(--transition);
            animation: fadeIn 0.5s ease-out;
        }

        .chat-bubble:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .chat-entry.user .chat-bubble {
            background-color: #dcf8c6;
        }

        .input-container {
            display: flex;
            padding: 20px;
            background-color: #fafafa;
            border-top: 1px solid #ddd;
            width: 600px;
            height: 80px;
        }

        .input-container input {
            padding: 10px;
            bottom: 235px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 400px;
            height: 30px;
        }

        .input-container button {
            padding: 10px 20px;
            margin-left: 10px;
            border: none;
            background-color: #007bff;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            width: 100px;
            height: 50px;
        }

        .input-container button:hover {
            background-color: #0056b3;
        }

        .loading {
            background-color: #ccc;
            /* 可以根据需要调整背景色 */
            color: transparent;
            /* 使文字透明 */
            pointer-events: none;
            /* 禁用点击事件 */
            position: relative;
            width: 100px;
            height: 50px;
        }

        .loading:after {
            content: '';
            position: absolute;

            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin-top: -10px;
            margin-left: -10px;
            border: 2px solid #fff;
            /* 转圈的颜色 */
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            /* 转圈的动画 */
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ----------------------历史记录----------------------------- */
        .status-records {
            max-height: 500px;
            overflow-y: auto;
            margin: 10px;
        }

        .record {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .record>div {
            flex: 1;
            padding: 5px;
        }

        .snapshot-btn {
            padding: 5px 10px;
            cursor: pointer;
        }

        .current-status {
            display: flex;
            flex-direction: column;
            margin-top: 0px;
            /* margin-left: 10%; */
            width: 100%;
        }

        .status-date-event {
            display: flex;
            justify-content: center;
        }

        .status-date-event_label {
            display: flex;
            justify-content: center;
            border-bottom: 1px solid #ddd;
        }

        #current_status {
            flex: 1
        }

        #current_date {
            flex: 1
        }

        #current_event {
            flex: 1
        }

        #current_status_label {
            flex: 1
        }

        #current_date_label {
            flex: 1
        }

        #current_event_label {
            flex: 1
        }

        .camera-button {
            display: flex;
            margin-top: 0px;
            width: 90%;
            /* 改为相对单位 */
            margin-left: 5%;
            /* 保留最大宽度限制 */
            /* aspect-ratio: 240/126; */
            /* 保持原比例(1200/504≈2.38) */
        }

        #camera_camera {
            flex: 1 1 70%;
            /* 占据70%宽度 */
            position: relative;
            background-color: rgb(0, 0, 0);
            border-radius: 5px 0 0 5px;
            aspect-ratio: 16/9;
            overflow: hidden;
        }

        #camera_camera img {
            width: 100%;
            /* height: 100%; */
            aspectRatio: 16/9;
            object-fit: cover;
            /* 保持图片比例填充 */
            color: #ffffff;
        }

        #camera_button {
            flex: 0 0 30%;
            /* 固定30%宽度 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* 按钮垂直居中 */
            align-items: center;
            background-color: rgb(214, 214, 214);
            padding: 20px;
            gap: 20px;
            /* 按钮间距 */
        }

        #camera_button input[type="button"] {
            width: 80%;
            padding: 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        @media (max-aspect-ratio: 4/3) {

            /* 在较方屏幕下切换为垂直布局 */
            .camera-button {
                flex-direction: column;
                aspect-ratio: unset;
                height: auto;
            }

            #camera_camera {

                width: 100%;
                /* height: 56.25vw; */
                /* 保持16:9高度 */
                flex: none;
            }

            #camera_button {
                flex: none;
                width: 100%;
                height: auto;
                flex-direction: row;
                /* 水平排列按钮 */
                justify-content: center;
                border-radius: 0 0 5px 5px;
            }

            #camera_button input[type="button"] {
                width: auto;
                padding: 10px 20px;
            }
        }

        #capture_close_btn {
            left: 45vw;
            width: 4vw;
            height: 4vh;
            position: absolute;
            border-style: none;
            background-color: var(--danger-color);
        }

        #menu {
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            height: 30px;
            width: 30px;
            /* background-color: var(--primary-color); */
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1;
            transition: var(--transition);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #menu:hover {
            background-color: var(--secondary-color);
            transform: translateY(-50%) scale(1.1);
        }

        #menu i {
            font-size: 20px;
            color: white;
            transition: var(--transition);
        }

        #menu:hover i {
            transform: rotate(180deg);
        }

        #menu.active i {
            transform: rotate(180deg);
        }

        #menu::before {
            content: '>';
            font-size: 16px;
            color: var(--text-color);
            transition: var(--transition);
        }

        #menu.active::before {
            content: '<';
            transform: translateX(-2px);
        }

        #menu.active {
            right: -30px;
        }

        #menu img {
            width: 24px;
            height: 24px;
            transition: var(--transition);
        }

        #menu.active img {
            transform: rotate(180deg);
        }

        /* 预警级别标签样式 */
        .alarm-level {
            padding: 4px 8px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            margin-right: 10px;
            min-width: 80px;
            text-align: center;
        }

        .alarm-level.red {
            background-color: #ff4d4f;
        }

        .alarm-level.orange {
            background-color: #faad14;
        }

        .alarm-level.yellow {
            background-color: #fadb14;
        }

        /* 带图标的输入框样式 */
        .input-with-icon {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .input-with-icon input {
            padding-right: 30px;
        }

        .input-with-icon .期望的辅助图标 {
            position: absolute;
            right: 8px;
            color: #999;
        }

        .camera-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .camera-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            color: white;
            box-shadow: var(--box-shadow);
        }

        .camera-button i {
            font-size: 18px;
        }

        .camera-open {
            background-color: var(--success-color);
        }

        .camera-open:hover {
            background-color: var(--success-color);
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .camera-close {
            background-color: var(--danger-color);
        }

        .camera-close:hover {
            background-color: var(--danger-color);
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .camera-capture {
            background-color: var(--primary-color);
        }

        .camera-capture:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .del-btn {
            background-color: var(--danger-color);
        }

        .del-btn:hover {
            background-color: var(--danger-color);
        }

        /* 服药数量样式 */
        .take-medicine-num-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(106, 179, 214, 0.1), rgba(142, 199, 224, 0.1));
            border-radius: var(--border-radius);
            margin: 15px 0;
            transition: var(--transition);
        }

        .take-medicine-num-container:hover {
            background: linear-gradient(135deg, rgba(106, 179, 214, 0.15), rgba(142, 199, 224, 0.15));
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .take-medicine-num-label {
            font-size: 18px;
            /* 增加标签字体大小 */
            font-weight: 600;
            color: var(--text-color);
            min-width: 100px;
        }

        .take-medicine-num-value {
            font-size: 28px;
            /* 增加数值字体大小 */
            font-weight: 700;
            color: var(--primary-color);
            padding: 5px 15px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            width: 5vw;
            text-align: center;
        }

        .take-medicine-num-unit {
            font-size: 18px;
            /* 增加单位字体大小 */
            font-weight: 600;
            color: var(--secondary-color);
            padding: 5px 10px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .take-medicine-num-edit {
            margin-left: auto;
        }

        .take-medicine-num-input {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            padding: 5px 15px;
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            width: 5vw;
            text-align: center;
            background: white;
            transition: var(--transition);
        }

        .take-medicine-num-input:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(106, 179, 214, 0.2);
            outline: none;
        }

        /* 提示弹窗样式 */
        .toast-container {
            position: fixed;
            top: 2vh;
            right: 2vw;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 1vh;
        }

        .toast {
            min-width: 20vw;
            max-width: 30vw;
            padding: 1.5vh 2vw;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 1vw;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease forwards;
        }

        .toast.success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .toast.error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .toast-icon {
            font-size: 1.5vw;
        }

        .toast-message {
            font-size: 1vw;
            flex: 1;
        }

        @keyframes slideIn {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }

            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            0% {
                transform: translateX(0);
                opacity: 1;
            }

            100% {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        .user_info_div{
            flex: 1; 
            padding: 15px; 
            background: white; 
            border-radius: var(--border-radius); 
            box-shadow: var(--box-shadow);
            font-size: 1vw;
        }
    </style>
    <!-- 服药 -->
    <style>
        .func_window {
            padding: 20px;
            background: #f5f7fa;
            border-radius: 10px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }

        .medicine-item {
            background: white;
            border-radius: 8px;
            margin: 15px 0;
            padding: 15px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        .medicine-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .medicine-header:hover {
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .medicine-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .medicine-header:hover::after {
            transform: scaleX(1);
        }

        .toggle-details {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 20px;
            cursor: pointer;
            transition: var(--transition);
            padding: 5px 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .toggle-details:hover {
            background: rgba(142, 205, 253, 0.1);
            color: var(--primary-color);
        }

        .toggle-details.active {
            color: var(--primary-color);
            transform: rotate(0deg);
        }

        .toggle-details.active:hover {
            background: rgba(142, 205, 253, 0.2);
        }

        .medicine-details {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: -10px;
            padding: 0 20px;
        }

        .medicine-details.expanded {
            max-height: 2000px;
            opacity: 1;
            transform: translateY(0);
            padding: 20px;
            margin-top: 0;
        }

        .medicine-item {
            background: white;
            border-radius: var(--border-radius);
            margin: 20px 0;
            padding: 0;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.5s ease-out;
            overflow: hidden;
        }

        .medicine-item:hover {
            transform: var(--hover-scale);
            box-shadow: var(--hover-shadow);
        }

        @keyframes slideDown {
            from {
                max-height: 0;
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                max-height: 2000px;
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                max-height: 2000px;
                opacity: 1;
                transform: translateY(0);
            }

            to {
                max-height: 0;
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        .medicine-details.expanded {
            animation: slideDown 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .medicine-details:not(.expanded) {
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .form-row {
            display: grid;
            grid-template-columns: auto 1fr auto 1fr;
            gap: 15px;
            margin: 10px 0;
        }

        .time-pickers {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .period-settings .period {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }

        .add-time,
        .add-period {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .add-time:hover {
            background-color: #62b965;
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .form-actions {
            margin-top: 20px;
            text-align: right;
        }

        .medicine-details {
            max-height: 0;
            overflow: hidden;
        }

        .medicine-details.expanded {
            max-height: 1000px;
        }

        .upload-container {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .pic-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }

        .preview-image {
            width: 20vw;
            height: 20vh;
            object-fit: contain;
        }
    </style>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            list-style-type: none;
        }

        a,
        img {
            border: 0;
        }

        body {
            font: 12px/180% Arial, Helvetica, sans-serif, "新宋体";
        }

        #sakura {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        @media screen and (max-width: 768px) {
            #sakura {
                width: 100vw;
                height: 100vh;
            }
        }
        .medicine-list{
            font-size: 1vw;
        }
        .medicine-name{
            width: 20vw;
        }
        #take_medicine_delay_change_button{
            margin-top: 2vh;
            margin-left: 0;
        }
    </style>
</head>

<body>
    <div id="header">
        <h2>老人监护系统</h2>
        <div class="user-info" style="display: none;">
            <!-- 用户头像接口，由后端提供URL -->
            <img src="{{ user_avatar_url }}" alt="用户头像">
            <div class="dropdown">
                <span>{{user_account}}</span>
                <div class="dropdown-content">
                    <a href="/profile">个人资料</a><br>
                    <a href="/">退出</a>
                </div>
            </div>
        </div>
    </div>
    <div id="top_window">
        <canvas id="sakura"></canvas>
        <div id="label_window">
            <div id="menu"><i class="ri-menu-line"></i></div>
            <div class="func_label active" id="func_1" style="margin-top: 15%;">
                <img class="func_icon" src="../static/img/用户.png">
                <span>老人状态</span>
            </div>
            <div class="func_label" id="func_2" onclick="fetchStatusRecords()">
                <img class="func_icon" src="../static/img/历史记录.png">
                <span>状态记录</span>
            </div>
            <div class="func_label" id="func_3" onclick="medicine_setting()">
                <img class="func_icon" src="../static/img/药品.png">
                <span>服药设置</span>
            </div>
            <div class="func_label" id="func_4" onclick="get_history()" style="display: none;">
                <img class="func_icon" src="../static/img/智能优化.png">
                <span>事件建议</span>
            </div>
            <div class="func_label" id="func_5" onclick="get_server_info()">
                <img class="func_icon" src="../static/img/状态.png">
                <span>系统状态</span>
            </div>
            <div class="func_label" id="func_6" onclick="initial_info_window()">
                <img class="func_icon" src="../static/img/个人信息.png">
                <span>用户信息</span>
            </div>
        </div>
        <div id="main_window">
            <div id="func_window1" class="func_window active">
                <div class="current-status">
                    <div class="camera-button">
                        <div id="camera_camera">
                            <img src="" id="camera_img" style="width: 100%; height: 100%;" alt="摄像头未开启">
                        </div>
                    </div>
                </div>
            </div>
            <div id="func_window2" class="func_window">

                <h2><img class="func_icon" src="../static/img/icons8-老人-64.png">状态记录</h2>
                <div class="status-records">
                    <div class="record-template">
                        <div class="record">
                            <div class="status">状态</div>
                            <div class="time">记录时间</div>
                            <div class="snapshot">
                                快照
                            </div>
                        </div>
                    </div>
                    <!-- 动态生成的记录将放置在这里 -->
                    <div id="records-container"></div>
                </div>

            </div>
            <div id="func_window3" class="func_window">
                <h2><img class="func_icon" src="../static/img/icons8-制药公司-50.png">服药设置</h2>
                <button class="add-medicine" onclick="add_medicine()"><i class="ri-add-line"></i>添加新药物</button>
                <div class="medicine-list" id="medicine_list">

                </div>
            </div>
            <div id="func_window4" class="func_window">
            </div>
            <div id="func_window5" class="func_window">
                <h2><img class="func_icon" src="../static/img/icons8-系统-50.png">系统状态</h2>
                <div id='server_data_all'>
                    <div id='circle_all'>
                        <div id='mem_circle'>
                            <div id='circle1_data_label'>
                                <tspan>设备内存信息</tspan>
                            </div>
                            <svg id='circle1_svg'>
                                <circle id='circle1' class="circle" cx="50%" cy="50%" r="45%"
                                    transform="rotate(-90 50% 50%)"></circle>
                                <text id='circle_percent' x="50%" y="50%" fill="#6b778c" text-anchor="middle">
                                    <tspan class="text">0</tspan>
                                    <tspan class="percent">%</tspan>
                                </text>
                            </svg>
                            <div id='circle1_data'>
                                <tspan id='mem_used'>0G</tspan>
                                <tspan>/</tspan>
                                <tspan id="mem_all">0G</tspan>
                            </div>
                        </div>
                        <div id='cpu_circle'>
                            <div id='circle2_data_label'>
                                <tspan>设备cpu信息</tspan>
                            </div>
                            <svg id='circle2_svg'>
                                <circle id='circle2' class="circle" cx="50%" cy="50%" r="45%"
                                    transform="rotate(-90 50% 50%)"></circle>
                                <text id='circle2_percent' x="50%" y="50%" fill="#6b778c" text-anchor="middle">
                                    <tspan class="text">0</tspan>
                                    <tspan class="percent">%</tspan>
                                </text>
                            </svg>
                            <div id='circle2_data'>
                                <tspan id='cpu_fre'>0Mhz</tspan>
                            </div>
                        </div>
                    </div>
                    <div id=server_data_cpu12>
                        <div id="CPU1" style="border:1px solid #ccc; padding:10px;"></div>
                        <div id="CPU2" style="border:1px solid #ccc; padding:10px;"></div>
                    </div>
                    <div id=server_data_cpu34>
                        <div id="CPU3" style="border:1px solid #ccc; padding:10px;"></div>
                        <div id="CPU4" style="border:1px solid #ccc; padding:10px;"></div>
                    </div>
                </div>
            </div>
            <div id="func_window6" class="func_window">
                <h2><img class="func_icon" src="../static/img/icons8-用户-100.png">用户信息</h2>
                <div style="display: flex; flex-direction: row; gap: 20px;">
                    <!-- 左侧：吃药延迟信息 -->
                    <div class="user_info_div">
                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">老人吃药延迟</h3>
                        <select id="take_medicine_delay_select" onchange="take_medicine_delay_select_change()" disabled
                            style="width: 100%; padding: 8px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: var(--border-radius);">
                            <option value="默认" id="delay_option_default">默认</option>
                            <option value="腿脚不便" id="delay_option_inconvenience">腿脚不便</option>
                            <option value="自定义" id="delay_option_customize">自定义</option>
                        </select>
                        <div id="alarm_show_div" style="display: flex; flex-direction: column; gap: 10px;">
                            <div
                                style="display: flex; flex-direction: row; align-items: center; padding: 10px; background: rgba(106, 179, 214, 0.1); border-radius: var(--border-radius);">
                                <div class="alarm-level red"><i class="ri-hourglass-fill"></i>一级预警</div>
                                <p id="take_medicine_delay_show_1" style="margin: 0 10px;">未设置</p>分钟
                            </div>
                            <div
                                style="display: flex; flex-direction: row; align-items: center; padding: 10px; background: rgba(106, 179, 214, 0.1); border-radius: var(--border-radius);">
                                <div class="alarm-level orange"><i class="ri-hourglass-fill"></i>二级预警</div>
                                <p id="take_medicine_delay_show_2" style="margin: 0 10px;">未设置</p>分钟
                            </div>
                            <div
                                style="display: flex; flex-direction: row; align-items: center; padding: 10px; background: rgba(106, 179, 214, 0.1); border-radius: var(--border-radius);">
                                <div class="alarm-level yellow"><i class="ri-hourglass-fill"></i>三级预警</div>
                                <p id="take_medicine_delay_show_3" style="margin: 0 10px;">未设置</p>分钟
                            </div>
                        </div>
                        <button id="take_medicine_delay_change_button" class="edit-button" onclick="delay_info_change()"
                            style="width: auto;">
                            <i class="ri-edit-line"></i>
                            <span>修改</span>
                        </button>
                    </div>

                    <!-- 右侧：联系人信息 -->
                    <div class="user_info_div">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="color: var(--primary-color);">联系人信息</h3>
                            <button onclick="add_contact_info()"
                                style="background: var(--primary-color); color: white; border: none; padding: 8px 15px; border-radius: var(--border-radius); cursor: pointer;">
                                <i class="ri-add-line"></i>添加联系人
                            </button>
                        </div>
                        <div id="contact_info_div" style="display: flex; flex-direction: column; gap: 15px;">
                            <!-- 联系人信息将通过JavaScript动态添加 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="toast-container" id="toastContainer"></div>
    <script>
        function take_medicine_delay_select_change() {
            console.log('select改变')
            selectElement = document.getElementById("take_medicine_delay_select");
            selectedIndex = selectElement.selectedIndex;
            value = selectElement.options[selectedIndex].value
            console.log(value)

            input1 = document.getElementById('take_medicine_delay_1')
            input2 = document.getElementById('take_medicine_delay_2')
            input3 = document.getElementById('take_medicine_delay_3')
            if (value == '默认') {
                input1.value = '1'
                input2.value = '5'
                input3.value = '10'
                input1.readOnly = true;
                input2.readOnly = true;
                input3.readOnly = true;
            }
            else if (value == '腿脚不便') {
                input1.value = '2'
                input2.value = '10'
                input3.value = '20'
                input1.readOnly = true;
                input2.readOnly = true;
                input3.readOnly = true;
            }
            else {
                console.log('设为自定义')
                input1.readOnly = false;
                input2.readOnly = false;
                input3.readOnly = false;
            }
        }
    </script>
    <script>

        function initial_info_window() {
            setTimeout(() => {
                initial_contact_info();
            }, 50);
            initial_delay_info();
        }
        function initial_delay_info() {
            e1 = document.getElementById('take_medicine_delay_show_1')
            e2 = document.getElementById('take_medicine_delay_show_2')
            e3 = document.getElementById('take_medicine_delay_show_3')
            $.ajax({
                url: 'http://127.0.0.1:3389/initial_delay_info',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(),
                success: function (response) {
                    if (response.status == 'complete') {
                        document.getElementById('')
                        if (response.delay_model == '自定义') {
                            document.getElementById('delay_option_customize').selected = true;
                        } else if (response.delay_model == '腿脚不便') {
                            document.getElementById('delay_option_inconvenience').selected = true;
                        }
                        else {
                            document.getElementById('delay_option_defalut').selected = true;
                        }
                        e1.innerHTML = response.delay1;
                        e2.innerHTML = response.delay2;
                        e3.innerHTML = response.delay3;
                        take_medicine_delay_select_change()
                    } else {
                        alert('初始化失败')
                    }
                },
                error: function (error) {
                    console.log('Error:', error);
                },
                complete: function () {
                }
            });
        }
        function initial_contact_info() {
            $.ajax({
                url: 'http://127.0.0.1:3389/initial_contact_info',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(),
                success: function (response) {
                    if (response.status == 'complete') {
                        old_list = document.getElementsByClassName('user_contact')
                        for (let j = 0; j < old_list.length; j++) {
                            old_list[i].remove();
                        }
                        par = document.getElementById('contact_info_div');
                        contact_info = response.data;
                        for (let i = 0; i < contact_info.length; i++) {
                            new_contact = document.createElement('div')
                            new_contact.setAttribute('id', `user_contact_${i}`)
                            new_contact.setAttribute('class', `user_contact`)
                            new_contact.innerHTML = `
                                <h3 style='margin-bottom:2vh;'>联系人${i}联系方式</h3>
                                <i class="ri-phone-line"></i>手机号：
                                <div style="display: flex;flex-direction: row;align-items: center;">
                                    <p style="margin-left: 20%;" id="user_info_phone_${i}">${contact_info[i][1]}</p>
                                    <input style="display: none;" type="text" id="user_info_phone_input_${i}">
                                    
                                    <button id="user_info_phone_change_${i}" class="edit-button" onclick="user_info_phone_change(${i})" style="width: auto;">
                                        <i class="ri-edit-line"></i>
                                        <span>修改</span>
                                    </button>
                                </div>
                                <i class="ri-mail-line"></i>邮箱：
                                <div style="display: flex;flex-direction: row;align-items: center;">
                                    <p style="margin-left: 20%;" id="user_info_email_${i}">${contact_info[i][2]}</p>
                                    <input style="display: none;" type="text" id="user_info_email_input_${i}">
                                    
                                    <button id="user_info_email_change_${i}" class="edit-button" onclick="user_info_email_change(${i})" style="width: auto;">
                                        <i class="ri-edit-line"></i>
                                        <span>修改</span>
                                    </button>
                                </div>
                                <button onclick='del_contact_info(${i})' class='del-btn'><i class="ri-delete-bin-6-line"></i>删除</button>
                            `
                            par.appendChild(new_contact);
                        }
                    } else {
                        alert('初始化失败')
                    }
                },
                error: function (error) {
                    console.log('Error:', error);
                },
                complete: function () {
                }
            });
        }
        function phone_email_send_info(num) {
            $.ajax({
                url: 'http://127.0.0.1:3389/change_contact_info',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 'phone': document.getElementById(`user_info_phone_${num}`).innerHTML, 'email': document.getElementById(`user_info_email_${num}`).innerHTML, 'id': num }),
                success: function (response) {
                    if (response.status == 'complete') {

                    } else {
                        alert('修改失败')
                    }
                },
                error: function (error) {
                    console.log('Error:', error);
                },
                complete: function () {
                }
            });
        }
        function send_delay_info() {
            selectElement = document.getElementById("take_medicine_delay_select");
            selectedIndex = selectElement.selectedIndex;

            new_delay_info = {
                'delay_model': selectElement.options[selectedIndex].value,
                'delay1': document.getElementById('take_medicine_delay_show_1').innerHTML,
                'delay2': document.getElementById('take_medicine_delay_show_2').innerHTML,
                'delay3': document.getElementById('take_medicine_delay_show_3').innerHTML
            }
            $.ajax({
                url: 'http://127.0.0.1:3389/change_delay_info',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(new_delay_info),
                success: function (response) {
                    if (response.status == 'complete') {

                    } else {
                        alert('修改失败')
                    }
                },
                error: function (error) {
                    console.log('Error:', error);
                },
                complete: function () {
                }
            });
        }
        function delay_info_change() {
            e = document.getElementById('take_medicine_delay_change_button')
            if (e.querySelector('span').innerHTML == '修改') {
                console.log('开始修改');
                document.getElementById('take_medicine_delay_select').disabled = false
                document.getElementById('alarm_show_div').style.display = 'none';
                document.getElementById('alarm_change_div').style.display = 'flex';
                for (let i = 1; i <= 3; i++) {
                    document.getElementById(`take_medicine_delay_${i}`).value = document.getElementById(`take_medicine_delay_show_${i}`).innerHTML
                }
                e.innerHTML = `
                    <i class="ri-save-line"></i>
                    <span>保存</span>
                `
            } else {
                console.log('开始保存');
                document.getElementById('take_medicine_delay_select').disabled = true
                document.getElementById('alarm_show_div').style.display = 'flex';
                document.getElementById('alarm_change_div').style.display = 'none';
                for (let i = 1; i <= 3; i++) {
                    document.getElementById(`take_medicine_delay_show_${i}`).innerHTML = document.getElementById(`take_medicine_delay_${i}`).value
                }
                e.innerHTML = `
                    <i class="ri-edit-line"></i>
                    <span>修改</span>
                `
                send_delay_info()

            }
        }
        function user_info_phone_change(num) {
            e = document.getElementById(`user_info_phone_change_${num}`)
            if (e.querySelector('span').innerHTML == '修改') {
                document.getElementById(`user_info_phone_${num}`).style.display = 'none';
                document.getElementById(`user_info_phone_input_${num}`).style.display = 'flex';
                document.getElementById(`user_info_phone_input_${num}`).value = document.getElementById(`user_info_phone_${num}`).innerHTML;
                e.innerHTML = `
                    <i class="ri-save-line"></i>
                    <span>保存</span>
                `
            } else {
                document.getElementById(`user_info_phone_${num}`).style.display = 'flex';
                document.getElementById(`user_info_phone_input_${num}`).style.display = 'none';
                document.getElementById(`user_info_phone_${num}`).value = document.getElementById(`user_info_phone_input_${num}`).innerHTML;
                e.innerHTML = `
                    <i class="ri-edit-line"></i>
                    <span>修改</span>
                `
                phone_email_send_info(num)

            }
        }
        function user_info_email_change(num) {
            e = document.getElementById(`user_info_email_change_${num}`)
            if (e.querySelector('span').innerHTML == '修改') {
                document.getElementById(`user_info_email_${num}`).style.display = 'none';
                document.getElementById(`user_info_email_input_${num}`).style.display = 'flex';
                document.getElementById(`user_info_email_input_${num}`).value = document.getElementById(`user_info_email_${num}`).innerHTML;
                e.innerHTML = `
                    <i class="ri-save-line"></i>
                    <span>保存</span>
                `
            } else {
                document.getElementById(`user_info_email_${num}`).style.display = 'flex';
                document.getElementById(`user_info_email_input_${num}`).style.display = 'none';
                document.getElementById(`user_info_email_${num}`).value = document.getElementById(`user_info_email_input_${num}`).innerHTML;
                e.innerHTML = `
                    <i class="ri-edit-line"></i>
                    <span>修改</span>
                `
                phone_email_send_info(num)
            }
        }
        function add_contact_info() {
            $.ajax({
                url: 'http://127.0.0.1:3389/add_contact_info',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(),
                success: function (response) {
                    if (response.status == 'complete') {
                        id = response.id
                        par = document.getElementById('contact_info_div');
                        new_contact = document.createElement('div')
                        new_contact.setAttribute('id', `user_contact_${id}`)
                        new_contact.setAttribute('class', `user_contact`)
                        new_contact.innerHTML = `
                            <h3 style='margin-bottom:2vh;'>联系人${id}联系方式</h3>
                            手机号：
                            <div style="display: flex;flex-direction: row;align-items: center;">
                                <p style="margin-left: 20%;" id="user_info_phone_${id}">未设置</p>
                                <input style="display: none;" type="text" id="user_info_phone_input_${id}">
                                
                                <button id="user_info_phone_change_${id}" class="edit-button" onclick="user_info_phone_change(${id})" style="width: auto;">
                                    <i class="ri-edit-line"></i>
                                    <span>修改</span>
                                </button>
                            </div>
                            邮箱：
                            <div style="display: flex;flex-direction: row;align-items: center;">
                                <p style="margin-left: 20%;" id="user_info_email_${id}">未设置</p>
                                <input style="display: none;" type="text" id="user_info_email_input_${id}">
                                
                                <button id="user_info_email_change_${id}" class="edit-button" onclick="user_info_email_change(${id})" style="width: auto;">
                                    <i class="ri-edit-line"></i>
                                    <span>修改</span>
                                </button>
                            </div>
                            <button onclick='del_contact_info(${id})' class='del-btn'><i class="ri-delete-bin-6-line"></i>删除</button>
                        `
                        par.appendChild(new_contact);
                    } else {
                        alert('添加失败')
                    }
                },
                error: function (error) {
                    console.log('Error:', error);
                },
                complete: function () {
                }
            });
        }
        function del_contact_info(num) {
            $.ajax({
                url: 'http://127.0.0.1:3389/del_contact_info',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 'id': num }),
                success: function (response) {
                    if (response.status == 'complete') {
                        document.getElementById(`user_contact_${num}`).remove();
                    } else {
                        alert('删除失败')
                    }
                },
                error: function (error) {
                    console.log('Error:', error);
                },
                complete: function () {
                }
            });
        }
    </script>
    <script>
        function camera_open_close() {
            imgElement = document.getElementById('camera_img');
            // e = document.getElementById('camera_button_open_close');
            // if (e.classList.contains('camera_close')) {
            //     e.classList.remove('camera_close');
            //     e.classList.add('camera_open');
            //     imgElement.src = "/video_feed";
            //     e.value = '关闭摄像头'
            // }
            // else {
            //     e.classList.remove('camera_open');
            //     e.classList.add('camera_close');
            //     imgElement.src = "";
            //     e.value = '开启摄像头'
            // }
            imgElement.src = "/";
        }
    </script>

    <script>
        var funcs = document.getElementsByClassName('func_label');
        var funcs_window = document.getElementsByClassName('func_window');
        for (var i = 0; i < funcs.length; i++) {
            funcs[i].addEventListener('click', function () {
                for (var j = 0; j < funcs.length; j++) {
                    funcs[j].classList.remove('active');
                    funcs_window[j].classList.remove('active');
                }
                var active_window = document.getElementById(`func_window${this.id.split('_')[1]}`);
                active_window.classList.add('active');
                this.classList.add('active');
            });
        }
    </script>

    <script>
        var mem_percent = 0;
        let mem_progressLen = 628;
        const mem_textDom = document.getElementsByClassName('text')[0];
        const mem_circleDom = document.getElementById('circle1');
        var cpu_percent = 0;
        let cpu_progressLen = 628;
        const cpu_textDom = document.getElementsByClassName('text')[1];
        const cpu_circleDom = document.getElementById('circle2');
        mem_setPercent = (num) => {
            if (num > 100) return;
            mem_circleDom.style['stroke-dashoffset'] = mem_progressLen - (mem_progressLen / 100) * num;
            mem_textDom.innerHTML = num;
        }

        cpu_setPercent = (num) => {
            if (num > 100) return;
            cpu_circleDom.style['stroke-dashoffset'] = cpu_progressLen - (cpu_progressLen / 100) * num;
            cpu_textDom.innerHTML = num;
        }

        setInterval(() => {
            // i+=Math.floor(Math.random()*5);
            // if(i>=100)i=100;
            mem_setPercent(mem_percent);
            cpu_setPercent(cpu_percent);
        }, 250)
        //--- 折柱 ---
        // 3个全局变量：time、cpu1、cpu2
        var time = ["", "", "", "", "", "", "", "", "", ""],
            cpu1 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            cpu2 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            cpu3 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            cpu4 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

        // 初始化CPU图表
        var CPU1 = echarts.init(document.getElementById('CPU1'), null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        CPU1.setOption({
            title: {
                text: 'CPU1'
            },
            tooltip: {
                trigger: 'axis'
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: ['cpu1']
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                name: 'cpu1',
                type: 'line',
                data: [0],
                smooth: true,
                areaStyle: {
                    opacity: 0.3
                }
            }]
        });

        // 添加窗口大小变化监听
        window.addEventListener('resize', function () {
            CPU1.resize();
        });

        var CPU2 = echarts.init(document.getElementById('CPU2'), null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        CPU2.setOption({
            title: {
                text: 'CPU2'
            },
            tooltip: {
                trigger: 'axis'
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: ['cpu2']
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                name: 'cpu2',
                type: 'line',
                data: [0],
                smooth: true,
                areaStyle: {
                    opacity: 0.3
                }
            }]
        });

        window.addEventListener('resize', function () {
            CPU2.resize();
        });

        var CPU3 = echarts.init(document.getElementById('CPU3'), null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        CPU3.setOption({
            title: {
                text: 'CPU3'
            },
            tooltip: {
                trigger: 'axis'
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: ['cpu3']
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                name: 'cpu3',
                type: 'line',
                data: [0],
                smooth: true,
                areaStyle: {
                    opacity: 0.3
                }
            }]
        });

        window.addEventListener('resize', function () {
            CPU3.resize();
        });

        var CPU4 = echarts.init(document.getElementById('CPU4'), null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        CPU4.setOption({
            title: {
                text: 'CPU4'
            },
            tooltip: {
                trigger: 'axis'
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: ['cpu4']
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                name: 'cpu4',
                type: 'line',
                data: [0],
                smooth: true,
                areaStyle: {
                    opacity: 0.3
                }
            }]
        });

        window.addEventListener('resize', function () {
            CPU4.resize();
        });

        //准备好的 callback 函数
        var update_CPU1 = function (res) { //res是json格式的response对象

            // 隐藏加载动画
            CPU1.hideLoading();

            // 准备数据
            time.push(res.data[0]);
            cpu1.push(parseFloat(res.data[1]));
            if (time.length >= 10) {
                time.shift();
                cpu1.shift();
            }
            //console.log(res.data[0],res.data[1],res.data[2],res.data[3],res.data[4]);
            // 填入数据
            CPU1.setOption({
                xAxis: {
                    data: time
                },
                series: [{
                    name: 'cpu1', // 根据名字对应到相应的系列
                    data: cpu1
                }]
            });

        };

        //第二张echarts图初始化
        var CPU2 = echarts.init(document.getElementById('CPU2'));
        CPU2.setOption({
            title: {
                text: 'CPU2'
            },
            tooltip: {},
            legend: {
                data: ['cpu2']
            },
            toolbox: {
                show: false,
                feature: {
                    mark: { show: true },
                    dataView: { show: true, readOnly: false },
                    magicType: { show: true, type: ['line', 'bar', 'stack', 'tiled'] },
                    restore: { show: true },
                    saveAsImage: { show: true }
                }
            },
            calculable: true,
            xAxis: {
                data: []
            },
            yAxis: {},
            series: [{
                name: 'cpu2',
                type: 'line',
                // smooth:true,
                // itemStyle: {normal: {areaStyle: {type: 'default'}}},
                // data: []
            }]
        });


        //准备好的 callback 函数
        var update_CPU2 = function (res) { //res是json格式的response对象

            // 隐藏加载动画
            CPU2.hideLoading();

            // 准备数据
            time.push(res.data[0]);
            cpu2.push(parseFloat(res.data[2]));
            if (time.length >= 10) {
                time.shift();
                cpu2.shift();
            }

            // 填入数据
            CPU2.setOption({
                xAxis: {
                    data: time
                },
                series: [{
                    name: 'cpu2', // 根据名字对应到相应的系列
                    data: cpu2
                }]
            });

        };
        /////////////////////////////////////////////////CPU3/////////////////////////////////////////
        //第三张echarts图初始化
        var CPU3 = echarts.init(document.getElementById('CPU3'));
        CPU3.setOption({
            title: {
                text: 'CPU3'
            },
            tooltip: {},
            legend: {
                data: ['cpu3']
            },
            xAxis: {
                data: []
            },
            yAxis: {},
            series: [{
                name: 'cpu3',
                type: 'line',
                data: []
            }]
        });


        //准备好的 callback 函数
        var update_CPU3 = function (res) { //res是json格式的response对象

            // 隐藏加载动画
            CPU3.hideLoading();

            // 准备数据
            time.push(res.data[0]);
            cpu3.push(parseFloat(res.data[3]));
            if (time.length >= 10) {
                time.shift();
                cpu3.shift();
            }

            // 填入数据
            CPU3.setOption({
                xAxis: {
                    data: time
                },
                series: [{
                    name: 'cpu3', // 根据名字对应到相应的系列
                    data: cpu3
                }]
            });

        };
        /////////////////////////////////////////////////CPU3/////////////////////////////////////////
        /////////////////////////////////////////////////CPU4/////////////////////////////////////////
        //第四张echarts图初始化
        var CPU4 = echarts.init(document.getElementById('CPU4'));
        CPU4.setOption({
            title: {
                text: 'CPU4'
            },
            tooltip: {},
            legend: {
                data: ['cpu4']
            },
            xAxis: {
                data: []
            },
            yAxis: {},
            series: [{
                name: 'cpu4',
                type: 'line',
                data: []
            }]
        });


        //准备好的 callback 函数
        var update_CPU4 = function (res) { //res是json格式的response对象

            // 隐藏加载动画
            CPU4.hideLoading();

            // 准备数据
            time.push(res.data[0]);
            cpu4.push(parseFloat(res.data[4]));
            if (time.length >= 10) {
                time.shift();
                cpu4.shift();
            }

            // 填入数据
            CPU4.setOption({
                xAxis: {
                    data: time
                },
                series: [{
                    name: 'cpu4', // 根据名字对应到相应的系列
                    data: cpu4
                }]
            });

        };
        /////////////////////////////////////////////////CPU4/////////////////////////////////////////
        //准备好的 callback 函数
        var mem = function (res) {
            mem_percent = res.data[7];
            const all_text = document.getElementById('mem_all')
            const used_text = document.getElementById('mem_used')
            all_text.innerHTML = res.data[5].toFixed(2) + 'G';
            used_text.innerHTML = res.data[6].toFixed(2) + 'G';

        }
        //准备好的 callback 函数
        var cpu = function (res) {
            const fre_text = document.getElementById('cpu_fre')
            fre_text.innerHTML = res.data[9] + 'Mhz';
            cpu_percent = res.data[8];
        }

        // 首次显示加载动画
        CPU1.showLoading();
        CPU2.showLoading();
        CPU3.showLoading();
        CPU4.showLoading();

        socket = [false]

        // 建立socket连接，等待设备"推送"数据，用回调函数更新图表
        function get_server_info() {
            namespace = '/server_info';
            socket[0] = io(location.protocol + '//' + document.domain + ':' + location.port + namespace);
            //console.log(location.protocol + '//' + document.domain + ':' + location.port + namespace);
            socket[0].on('server_response', function (res) {
                //console.log(res);
                update_CPU1(res);
                update_CPU2(res);
                update_CPU3(res);
                update_CPU4(res);
                mem(res);
                cpu(res);

            });

        };

    </script>
    <!-- -----------------------------------------------事件记录-------------------------------------------------- -->
    <script>

        function fetchStatusRecords() {
            $.ajax({
                url: 'http://127.0.0.1:3389/status_records',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(),
                success: function (response) {
                    const recordsContainer = document.getElementById('records-container');
                    const recordTemplate = document.querySelector('.record-template').innerHTML;
                    recordsContainer.innerHTML = '';
                    rows = response.rows;
                    rows.forEach(record => {
                        const recordElement = document.createElement('div');//<div class="threat-level">${record[2]}</div>
                        recordElement.innerHTML = `
                    <div class="record">
                        <div class="status" style = "color:${record[1]}">${record[0]}</div>
                        
                        <div class="time">${record[3]}-${record[4]}-${record[5]} ${record[6]}:${record[7]}:${record[8]}</div>
                        <div class="snapshot">
                            <button class="snapshot-btn" onclick="viewSnapshot('${record[9]}')"><i class="ri-image-line"></i>查看快照</button>
                            </div>
                        </div>`;
                        recordsContainer.appendChild(recordElement);
                    });
                },
                error: function (error) {
                    console.log('Error:', error);
                },
                complete: function () {
                }
            });
            //关闭socket
            if (socket[0] != false) {
                socket[0].disconnect();
                socket[0] = false;
            }

        }



        function viewSnapshot(snapshotId) {
            header = document.getElementById('header');
            $.ajax({
                url: 'http://127.0.0.1:3389/get_capture_img',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 'id': snapshotId }),
                xhrFields: {
                    responseType: 'blob'  // 确保返回数据类型为Blob
                },
                success: function (blob) {
                    var url = URL.createObjectURL(blob);
                    e = document.createElement('div');
                    e.innerHTML = `<button id = "capture_close_btn" onclick = "capture_close()"><i class="ri-close-line"></i></button>
                        <img style="width:100%; height:100%;" src="${url}">`;
                    e.setAttribute('id', 'capture_img');
                    e.style.position = 'fixed';
                    e.style.top = '50%';
                    e.style.left = '50%';
                    e.style.transform = 'translate(-50%, -50%)';
                    e.style.maxWidth = '90vw';
                    e.style.maxHeight = '90vh';
                    e.style.aspectRatio = '16/9'; // 强制保持16:9比例
                    e.style.background = 'rgba(0,0,0,0.8)';
                    e.style.boxShadow = '0 0 20px rgba(0,0,0,0.5)';
                    e.style.overflow = 'hidden';
                    e.style.border = '1px solid yellow'
                    document.body.appendChild(e);
                },
                error: function (error) {
                    console.log('Error:', error);
                },
                complete: function () {
                }

            });
        }

        function capture_close() {
            e = document.getElementById('capture_img');
            e.remove();
        }

        document.getElementById('menu').addEventListener('click', function () {
            this.classList.toggle('active');
            document.getElementById('label_window').classList.toggle('active');
        });
        function medicine_setting() {

        }
    </script>
    <script>
        function medicine_name_change(num) {
            e = document.getElementById(`medicine_name_change_${num}`)
            if (e.querySelector('span').innerHTML == '修改') {
                document.getElementById(`medicine_name_${num}`).style.display = 'none';
                document.getElementById(`medicine_name_input_${num}`).style.display = 'flex';
                document.getElementById(`medicine_name_input_${num}`).value = document.getElementById(`medicine_name_${num}`).innerHTML;
                e.innerHTML = `
                    <i class="ri-save-line"></i>
                    <span>保存</span>
                `
            } else {
                document.getElementById(`medicine_name_${num}`).style.display = 'flex';
                document.getElementById(`medicine_name_input_${num}`).style.display = 'none';
                document.getElementById(`medicine_name_${num}`).innerHTML = document.getElementById(`medicine_name_input_${num}`).value;
                e.innerHTML = `
                    <i class="ri-edit-line"></i>
                    <span>修改</span>
                `
            }
        }
        function medicine_category_select_change(num) {
            obj = document.getElementById(`medicine_category_select_${num}`);
            index = obj.selectedIndex;
            value = obj.options[index].value;
            num_div = document.getElementById(`take_medicine_num_div_${num}`)
            num_unit = document.getElementById(`take_medicine_unit_${num}`)
            if (value == '片剂') {
                num_unit.innerHTML = '片'
                num_div.style.display = 'flex'
            } else if (value == '胶囊') {
                num_unit.innerHTML = '粒'
                num_div.style.display = 'flex'
            } else if (value == '口服液') {
                num_unit.innerHTML = '瓶/袋'
                num_div.style.display = 'flex'
            } else if (value == '贴剂') {
                num_div.style.display = 'none'
            } else if (value == '注射剂') {
                num_unit.innerHTML = '支'
                num_div.style.display = 'flex'
            }
        }
        function take_medicine_num_change(num) {
            e = document.getElementById(`take_medicine_num_change_${num}`)
            if (e.querySelector('span').innerHTML == '修改') {
                document.getElementById(`take_medicine_num_${num}`).style.display = 'none';
                document.getElementById(`take_medicine_num_input_${num}`).style.display = 'flex';
                document.getElementById(`take_medicine_num_input_${num}`).value = document.getElementById(`take_medicine_num_${num}`).innerHTML;
                e.innerHTML = `
                    <i class="ri-save-line"></i>
                    <span>保存</span>
                `
            } else {
                document.getElementById(`take_medicine_num_${num}`).style.display = 'flex';
                document.getElementById(`take_medicine_num_input_${num}`).style.display = 'none';
                document.getElementById(`take_medicine_num_${num}`).innerHTML = document.getElementById(`take_medicine_num_input_${num}`).value;
                e.innerHTML = `
                    <i class="ri-edit-line"></i>
                    <span>修改</span>
                `
            }
        }
        function medicine_expand(num) {
            const details = document.getElementById(`medicine_details_${num}`);
            const expandBtn = document.getElementById(`medicine_expand_${num}`);
            const header = document.getElementById(`medicine_header_${num}`);

            if (details.classList.contains('expanded')) {
                // 收缩动画
                details.classList.remove('expanded');
                expandBtn.innerHTML = '◄';
                expandBtn.classList.remove('active');
                header.style.borderRadius = 'var(--border-radius)';
            } else {
                // 展开动画
                details.classList.add('expanded');
                expandBtn.innerHTML = '▼';
                expandBtn.classList.add('active');
                header.style.borderRadius = 'var(--border-radius) var(--border-radius) 0 0';
            }
        }
        function medicine_add_take_time(num) {
            parentElement = document.getElementById(`medicine_take_times_${num}`);
            timeElements = parentElement.querySelectorAll('input[type="time"]');
            newtime = document.createElement('input')
            newtime.setAttribute('type', 'time')
            newtime.setAttribute('id', `medicine_take_time_${num}_${timeElements.length}`)
            document.getElementById(`medicine_take_times_${num}`).insertBefore(newtime, timeElements[0]);
        }
        function initial_medicine_create_div(medicine) {
            num = document.getElementsByClassName('medicine-item').length
            list = document.getElementById('medicine_list')
            new_medicine = document.createElement('div')
            new_medicine.setAttribute('class', 'medicine-item')
            new_medicine.setAttribute('data-medicine_id', medicine['id'])
            new_medicine.setAttribute('id', `medicine-item${num}`)
            new_medicine.innerHTML = `
                    <div class="medicine-header" id='medicine_header_${num}'>
                        <div style='display:flex;flex-direction:row;align-items: center;'>
                            <h3 class='medicine-name' id="medicine_name_${num}">${medicine['name']}</h3>
                            <input style="display: none;" type="text" id="medicine_name_input_${num}">
                            <button id="medicine_name_change_${num}" class="edit-button" onclick="medicine_name_change(${num})" style="width: auto;">
                                <i class="ri-edit-line"></i>
                                <span>修改</span>
                            </button>

                        </div>
                        <button class="toggle-details"  id='medicine_expand_${num}' onclick='medicine_expand(${num})'>◄</button>
                    </div>
                    
                    <form class="medicine-details" id='medicine_details_${num}'>
                        <!-- 药物基本信息 -->
                        <div class="form-row">        
                            <label>药品类别：</label>
                            <select id='medicine_category_select_${num}' onchange='medicine_category_select_change(${num})'>
                                <option value="片剂" ${medicine['category'] === '片剂' ? 'selected' : ''}>片剂</option>
                                <option value="胶囊" ${medicine['category'] === '胶囊' ? 'selected' : ''}>胶囊</option>
                                <option value="口服液" ${medicine['category'] === '口服液' ? 'selected' : ''}>口服液</option>
                                <option value="贴剂" ${medicine['category'] === '贴剂' ? 'selected' : ''}>贴剂</option>
                                <option value="注射剂" ${medicine['category'] === '注射剂' ? 'selected' : ''}>注射剂</option>
                            </select>
                        </div>
                        <!-- 时间设置 -->
                        <div class="time-settings">
                            <div class="time-group">
                                <label>过期时间：</label>
                                <input type="date" id='medicine_past_time_${num}' value='${medicine['past_time']}'>
                            </div>
                            
                            <div class="time-group">
                                <label>每日服药时间：</label>
                                <div class="time-pickers"  id='medicine_take_times_${num}'>
                                    <input type="time"  id='medicine_take_time_${num}_0' value='${medicine['take_time'][0]}'>
                                    <button type="button" class="add-time" id='medicine_add_take_time_${num}' onclick='medicine_add_take_time(${num})'>+</button>
                                </div>
                            </div>

                            <div class="take-medicine-num-container" id='take_medicine_num_div_${num}'>
                                <span class="take-medicine-num-label">服药数量：</span>
                                <span class="take-medicine-num-value" id="take_medicine_num_${num}">${medicine['take_times']}</span>
                                <input class="take-medicine-num-input" style="display: none;width:5vw;" type="text" id="take_medicine_num_input_${num}">
                                <span class="take-medicine-num-unit" id="take_medicine_unit_${num}"></span>
                                <button type="button" id="take_medicine_num_change_${num}" class="edit-button take-medicine-num-edit" onclick="take_medicine_num_change(${num})">
                                    <i class="ri-edit-line"></i>
                                    <span>修改</span>
                                </button>
                            </div>

                        </div>

                        <!-- 时间段设置 -->
                        <div class="period-settings">
                            <label>用药周期：</label>
                            <div class="period">
                                <input type="date" placeholder="开始日期"  id='medicine_period_start_${num}' value='${medicine['period_start']}'>
                                <span>至</span>
                                <input type="date" placeholder="结束日期"  id='medicine_period_end_${num}' value='${medicine['period_end']}'>
                            </div>
                        </div>

                        <!-- 特殊提示 -->
                        <div class="special-notes">
                            <label>特殊用药提示：</label>
                            <textarea placeholder="如：需空腹服用、服药后避光..." id='medicine_tips_${num}'>${medicine['tips']}</textarea>
                        </div>
                        <p style='color:#000'>药物图片</p>
                        <div>
                            <div class="upload-container">
                                <input type="file" class="pic-input" id="pic_input_${num}_1" accept="image/*">
                                <img class="preview-image" id="preview_image_${num}_1" src="data:image/jpeg;base64,${medicine['pic1']}" alt="点击上传图片">
                            </div>
                            <div class="upload-container">
                                <input type="file" class="pic-input" id="pic_input_${num}_2" accept="image/*">
                                <img class="preview-image" id="preview_image_${num}_2" src="data:image/jpeg;base64,${medicine['pic2']}" alt="点击上传图片">
                            </div>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="form-actions">
                            <button type="button" class="save-button" id='medicine_save_${num}' onclick='save_medicine(${num},${new_medicine.dataset.medicine_id})'><i class="ri-save-line"></i>保存设置</button>
                            <button type="button" class="delete-medicine" id='medicine_del_${num}' onclick='del_medicine(${num},${new_medicine.dataset.medicine_id})'><i class="ri-delete-bin-6-line"></i>删除药品</button>
                        </div>
                    </form>
                `
            list.appendChild(new_medicine)
            // 设置其余吃药时间
            if (medicine['take_time'].length > 1) {
                for (let i = 1; i < medicine['take_time'].length; i++) {
                    parentElement = document.getElementById(`medicine_take_times_${num}`);
                    timeElements = parentElement.querySelectorAll('input[type="time"]');
                    newtime = document.createElement('input')
                    newtime.setAttribute('type', 'time')
                    newtime.setAttribute('value', `${medicine['take_time'][i]}`)
                    newtime.setAttribute('id', `medicine_take_time_${num}_${timeElements.length}`)
                    document.getElementById(`medicine_take_times_${num}`).insertBefore(newtime, timeElements[0]);
                    medicine_category_select_change(num)
                }
            }
            const fileInput1 = document.getElementById(`pic_input_${num}_1`);
            const previewImage1 = document.getElementById(`preview_image_${num}_1`);
            const fileInput2 = document.getElementById(`pic_input_${num}_2`);
            const previewImage2 = document.getElementById(`preview_image_${num}_2`);

            fileInput1.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (!file) return;

                // 创建临时URL预览图片
                const objectURL = URL.createObjectURL(file);

                // 替换预览图片
                previewImage1.src = objectURL;

                // 可选：图片加载完成后释放内存
                previewImage1.onload = function () {
                    URL.revokeObjectURL(objectURL);
                }
            });
            fileInput2.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (!file) return;

                // 创建临时URL预览图片
                const objectURL = URL.createObjectURL(file);

                // 替换预览图片
                previewImage2.src = objectURL;

                // 可选：图片加载完成后释放内存
                previewImage2.onload = function () {
                    URL.revokeObjectURL(objectURL);
                }
            });
        }
        initial_medicine()
        function initial_medicine() {
            $.ajax({
                url: 'http://127.0.0.1:3389/initial_medicine',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(),
                success: function (response) {
                    medicines = response.medicines
                    console.log(medicines.length)
                    for (let i = 0; i < medicines.length; i++) {
                        initial_medicine_create_div(medicines[i])
                        console.log('——————————————————————————————————————')
                        console.log(i)
                    }
                },
                error: function (error) {
                    alert('初始化失败，失败原因:', error)
                },
                complete: function () {

                }
            });
        }

        function del_medicine(num, id) {
            $.ajax({
                url: 'http://127.0.0.1:3389/del_medicine',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 'id': id }),
                success: function (response) {
                    document.getElementById(`medicine-item${num}`).remove()
                    showToast('删除成功', 'success')
                },
                error: function (error) {
                    showToast(`删除失败，失败原因:${error}`, 'error')
                },
                complete: function () {

                }
            });
        }

        function save_medicine(num, id) {

            name = document.getElementById(`medicine_name_${num}`).innerHTML
            category = document.getElementById(`medicine_category_select_${num}`)
            past_time = document.getElementById(`medicine_past_time_${num}`)
            parentElement = document.getElementById(`medicine_take_times_${num}`);
            timeElements = parentElement.querySelectorAll('input[type="time"]');
            take_time = []
            for (i = 0; i < timeElements.length; i++) {
                take_time.push(timeElements[i].value)
            }
            period_start = document.getElementById(`medicine_period_start_${num}`)
            period_end = document.getElementById(`medicine_period_end_${num}`)
            tips = document.getElementById(`medicine_tips_${num}`)
            take_times = document.getElementById(`take_medicine_num_${num}`)
            pic1 = document.getElementById(`pic_input_${num}_1`).files[0]
            pic2 = document.getElementById(`pic_input_${num}_2`).files[0]
            if (document.getElementById(`preview_image_${num}_1`).src == './static/img/添加图片.png' || document.getElementById(`preview_image_${num}_2`).src == './static/img/添加图片.png') {
                alert('请上传两张图片')
                return
            }
            formData = new FormData();
            // 添加文件
            formData.append("pic1", pic1);
            formData.append("pic2", pic2);

            // 添加其他字段
            formData.append("id", id);
            formData.append("name", name);
            formData.append("category", category.value);
            formData.append("past_time", past_time.value);
            formData.append("period_start", period_start.value);
            formData.append("period_end", period_end.value);
            formData.append("tips", tips.value);
            formData.append("take_time", JSON.stringify(take_time));  // 数组需要序列化
            formData.append("take_times", take_times.innerHTML);

            // 发送请求
            $.ajax({
                url: 'http://127.0.0.1:3389/save_medicine',
                type: 'POST',
                contentType: false,  // 必须设置 false，浏览器会自动生成正确的 Content-Type
                processData: false,  // 必须设置 false，避免 jQuery 转换数据
                data: formData,      // 直接传递 FormData 对象
                success: function (response) {
                    showToast('保存成功', 'success');
                },
                error: function (xhr, status, error) {
                    saveError(xhr.responseJSON?.error || '未知错误');
                }
            });

        }

        function add_medicine() {
            $.ajax({
                url: 'http://127.0.0.1:3389/add_medicine',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(),
                success: function (response) {
                    id = response.id
                    num = document.getElementsByClassName('medicine-item').length
                    // console.log(num)
                    list = document.getElementById('medicine_list')
                    new_medicine = document.createElement('div')
                    new_medicine.setAttribute('class', 'medicine-item')
                    new_medicine.setAttribute('id', `medicine-item${num}`)
                    // console.log(new_medicine.dataset.medicine_id)
                    new_medicine.innerHTML = `
                    <div class="medicine-header" id='medicine_header_${num}'>
                        <div style='display:flex;flex-direction:row;align-items: center;'>
                            <h3 class='medicine-name' id="medicine_name_${num}">药物名称</h3>
                            <input style="display: none;" type="text" id="medicine_name_input_${num}">
                            <button id="medicine_name_change_${num}" class="edit-button" onclick="medicine_name_change(${num})" style="width: auto;">
                                <i class="ri-edit-line"></i>
                                <span>修改</span>
                            </button>
                        </div>
                        <button class="toggle-details" id='medicine_expand_${num}' onclick='medicine_expand(${num})'>◄</button>
                    </div>
                    
                    <form class="medicine-details" id='medicine_details_${num}'>
                        <!-- 药物基本信息 -->
                        <div class="form-row">        
                            <label>药品类别：</label>
                            <select id='medicine_category_select_${num}'  onchange='medicine_category_select_change(${num})'>
                                <option>片剂</option>
                                <option>胶囊</option>
                                <option>口服液</option>
                                <option>贴剂</option>
                                <option>注射剂</option>
                            </select>
                        </div>

                        <!-- 时间设置 -->
                        <div class="time-settings">
                            <div class="time-group">
                                <label>过期时间：</label>
                                <input type="date" id='medicine_past_time_${num}'>
                            </div>
                            
                            <div class="time-group">
                                <label>每日服药时间：</label>
                                <div class="time-pickers"  id='medicine_take_times_${num}'>
                                    <input type="time"  id='medicine_take_time_${num}_0'>
                                    <button type="button" class="add-time" id='medicine_add_take_time_${num}' onclick='medicine_add_take_time(${num})'>+</button>
                                </div>
                            </div>
                        </div>

                        <div style='display:flex;flex-direction:row;align-items: center;' id='take_medicine_num_div_${num}'>
                            <p id="take_medicine_num_${num}">未设置</p>
                            <input style="display: none;" type="text" id="take_medicine_num_input_${num}">
                            <p id="take_medicine_unit_${num}"></p>
                            <button type="button" id="take_medicine_num_change_${num}" class="edit-button" onclick="take_medicine_num_change(${num})" style="width: auto;">
                                    <i class="ri-edit-line"></i>
                                    <span>修改</span>
                            </button>
                        </div>

                        <!-- 时间段设置 -->
                        <div class="period-settings">
                            <label>用药周期：</label>
                            <div class="period">
                                <input type="date" placeholder="开始日期"  id='medicine_period_start_${num}'>
                                <span>至</span>
                                <input type="date" placeholder="结束日期"  id='medicine_period_end_${num}'>
                            </div>
                        </div>

                        <!-- 特殊提示 -->
                        <div class="special-notes">
                            <label>特殊用药提示：</label>
                            <textarea placeholder="如：需空腹服用、服药后避光..." id='medicine_tips_${num}'></textarea>
                        </div>

                        <p style='color:#000'>药物图片</p>
                        <div>
                            <div class="upload-container">
                                <input type="file" class="pic-input" id="pic_input_${num}_1" accept="image/*">
                                <img class="preview-image" id="preview_image_${num}_1" src="./static/img/添加图片.png" alt="点击上传图片">
                            </div>
                            <div class="upload-container">
                                <input type="file" class="pic-input" id="pic_input_${num}_2" accept="image/*">
                                <img class="preview-image" id="preview_image_${num}_2" src="./static/img/添加图片.png" alt="点击上传图片">
                            </div>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="form-actions">
                            <button type="button" class="save-button" id='medicine_save_${num}' onclick='save_medicine(${num},${id})'><i class="ri-save-line"></i>保存设置</button>
                            <button type="button" class="delete-medicine" id='medicine_del_${num}' onclick='del_medicine(${num},${id})'><i class="ri-delete-bin-6-line"></i>删除药品</button>
                        </div>
                    </form>
                `
                    list.appendChild(new_medicine)
                    const fileInput1 = document.getElementById(`pic_input_${num}_1`);
                    const previewImage1 = document.getElementById(`preview_image_${num}_1`);
                    const fileInput2 = document.getElementById(`pic_input_${num}_2`);
                    const previewImage2 = document.getElementById(`preview_image_${num}_2`);

                    fileInput1.addEventListener('change', function (e) {
                        const file = e.target.files[0];
                        if (!file) return;

                        // 创建临时URL预览图片
                        const objectURL = URL.createObjectURL(file);

                        // 替换预览图片
                        previewImage1.src = objectURL;

                        // 可选：图片加载完成后释放内存
                        previewImage1.onload = function () {
                            URL.revokeObjectURL(objectURL);
                        }
                    });
                    fileInput2.addEventListener('change', function (e) {
                        const file = e.target.files[0];
                        if (!file) return;

                        // 创建临时URL预览图片
                        const objectURL = URL.createObjectURL(file);

                        // 替换预览图片
                        previewImage2.src = objectURL;

                        // 可选：图片加载完成后释放内存
                        previewImage2.onload = function () {
                            URL.revokeObjectURL(objectURL);
                        }
                    });
                },
                error: function (error) {
                    alert('保存失败，失败原因:', error)
                },
                complete: function () {

                }
            });
        }
        function camera_shot() {
            $.ajax({
                url: 'http://127.0.0.1:3389/camera_shot',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(),
                success: function (response) {
                    if (response.status == 'complete') {
                        alert('拍照成功')
                    } else {
                        alert('拍照失败')
                    }
                },
                error: function (error) {
                    alert('拍照失败，失败原因:', error)
                },
                complete: function () {

                }
            });
        }
    </script>
    <script>
        camera_open_close()
    </script>
    <script>
        document.getElementById('label_window').addEventListener('click', function (e) {
            if (e.target === this || e.target === this.firstElementChild) {
                this.classList.toggle('active');
            }
        });
    </script>
    <script src="js/sakura.js"></script>
    <script src="./static/js/sakura.js"></script>
    <script id="sakura_point_vsh" type="x-shader/x_vertex">
        uniform mat4 uProjection;
        uniform mat4 uModelview;
        uniform vec3 uResolution;
        uniform vec3 uOffset;
        uniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius
        uniform vec3 uFade; //x:start distance, y:half distance, z:near fade start
        
        attribute vec3 aPosition;
        attribute vec3 aEuler;
        attribute vec2 aMisc; //x:size, y:fade
        
        varying vec3 pposition;
        varying float psize;
        varying float palpha;
        varying float pdist;
        
        //varying mat3 rotMat;
        varying vec3 normX;
        varying vec3 normY;
        varying vec3 normZ;
        varying vec3 normal;
        
        varying float diffuse;
        varying float specular;
        varying float rstop;
        varying float distancefade;
        
        void main(void) {
            // Projection is based on vertical angle
            vec4 pos = uModelview * vec4(aPosition + uOffset, 1.0);
            gl_Position = uProjection * pos;
            gl_PointSize = aMisc.x * uProjection[1][1] / -pos.z * uResolution.y * 0.5;
        
            pposition = pos.xyz;
            psize = aMisc.x;
            pdist = length(pos.xyz);
            palpha = smoothstep(0.0, 1.0, (pdist - 0.1) / uFade.z);
        
            vec3 elrsn = sin(aEuler);
            vec3 elrcs = cos(aEuler);
            mat3 rotx = mat3(
                1.0, 0.0, 0.0,
                0.0, elrcs.x, elrsn.x,
                0.0, -elrsn.x, elrcs.x
            );
            mat3 roty = mat3(
                elrcs.y, 0.0, -elrsn.y,
                0.0, 1.0, 0.0,
                elrsn.y, 0.0, elrcs.y
            );
            mat3 rotz = mat3(
                elrcs.z, elrsn.z, 0.0, 
                -elrsn.z, elrcs.z, 0.0,
                0.0, 0.0, 1.0
            );
            mat3 rotmat = rotx * roty * rotz;
            normal = rotmat[2];
        
            mat3 trrotm = mat3(
                rotmat[0][0], rotmat[1][0], rotmat[2][0],
                rotmat[0][1], rotmat[1][1], rotmat[2][1],
                rotmat[0][2], rotmat[1][2], rotmat[2][2]
            );
            normX = trrotm[0];
            normY = trrotm[1];
            normZ = trrotm[2];
        
            const vec3 lit = vec3(0.6917144638660746, 0.6917144638660746, -0.20751433915982237);
        
            float tmpdfs = dot(lit, normal);
            if(tmpdfs < 0.0) {
                normal = -normal;
                tmpdfs = dot(lit, normal);
            }
            diffuse = 0.4 + tmpdfs;
        
            vec3 eyev = normalize(-pos.xyz);
            if(dot(eyev, normal) > 0.0) {
                vec3 hv = normalize(eyev + lit);
                specular = pow(max(dot(hv, normal), 0.0), 20.0);
            }
            else {
                specular = 0.0;
            }
        
            rstop = clamp((abs(pdist - uDOF.x) - uDOF.y) / uDOF.z, 0.0, 1.0);
            rstop = pow(rstop, 0.5);
            //-0.69315 = ln(0.5)
            distancefade = min(1.0, exp((uFade.x - pdist) * 0.69315 / uFade.y));
        }
        </script>
    <script id="sakura_point_fsh" type="x-shader/x_fragment">
        #ifdef GL_ES
        //precision mediump float;
        precision highp float;
        #endif
        
        uniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius
        uniform vec3 uFade; //x:start distance, y:half distance, z:near fade start
        
        const vec3 fadeCol = vec3(0.08, 0.03, 0.06);
        
        varying vec3 pposition;
        varying float psize;
        varying float palpha;
        varying float pdist;
        
        //varying mat3 rotMat;
        varying vec3 normX;
        varying vec3 normY;
        varying vec3 normZ;
        varying vec3 normal;
        
        varying float diffuse;
        varying float specular;
        varying float rstop;
        varying float distancefade;
        
        float ellipse(vec2 p, vec2 o, vec2 r) {
            vec2 lp = (p - o) / r;
            return length(lp) - 1.0;
        }
        
        void main(void) {
            vec3 p = vec3(gl_PointCoord - vec2(0.5, 0.5), 0.0) * 2.0;
            vec3 d = vec3(0.0, 0.0, -1.0);
            float nd = normZ.z; //dot(-normZ, d);
            if(abs(nd) < 0.0001) discard;
        
            float np = dot(normZ, p);
            vec3 tp = p + d * np / nd;
            vec2 coord = vec2(dot(normX, tp), dot(normY, tp));
        
            //angle = 15 degree
            const float flwrsn = 0.258819045102521;
            const float flwrcs = 0.965925826289068;
            mat2 flwrm = mat2(flwrcs, -flwrsn, flwrsn, flwrcs);
            vec2 flwrp = vec2(abs(coord.x), coord.y) * flwrm;
        
            float r;
            if(flwrp.x < 0.0) {
                r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.36, 0.96) * 0.5);
            }
            else {
                r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.58, 0.96) * 0.5);
            }
        
            if(r > rstop) discard;
        
            vec3 col = mix(vec3(1.0, 0.8, 0.75), vec3(1.0, 0.9, 0.87), r);
            float grady = mix(0.0, 1.0, pow(coord.y * 0.5 + 0.5, 0.35));
            col *= vec3(1.0, grady, grady);
            col *= mix(0.8, 1.0, pow(abs(coord.x), 0.3));
            col = col * diffuse + specular;
        
            col = mix(fadeCol, col, distancefade);
        
            float alpha = (rstop > 0.001)? (0.5 - r / (rstop * 2.0)) : 1.0;
            alpha = smoothstep(0.0, 1.0, alpha) * palpha;
        
            gl_FragColor = vec4(col * 0.5, alpha);
        }
        </script>
    <!-- effects -->
    <script id="fx_common_vsh" type="x-shader/x_vertex">
        uniform vec3 uResolution;
        attribute vec2 aPosition;
        
        varying vec2 texCoord;
        varying vec2 screenCoord;
        
        void main(void) {
            gl_Position = vec4(aPosition, 0.0, 1.0);
            texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);
            screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);
        }
        </script>
    <script id="bg_fsh" type="x-shader/x_fragment">
        #ifdef GL_ES
        //precision mediump float;
        precision highp float;
        #endif
        
        uniform vec2 uTimes;
        
        varying vec2 texCoord;
        varying vec2 screenCoord;
        
        void main(void) {
            vec3 col;
            float c;
            vec2 tmpv = texCoord * vec2(0.8, 1.0) - vec2(0.95, 1.0);
            c = exp(-pow(length(tmpv) * 1.8, 2.0));
            col = mix(vec3(0.02, 0.0, 0.03), vec3(0.96, 0.98, 1.0) * 1.5, c);
            gl_FragColor = vec4(col * 0.5, 1.0);
        }
        </script>
    <script id="fx_brightbuf_fsh" type="x-shader/x_fragment">
        #ifdef GL_ES
        //precision mediump float;
        precision highp float;
        #endif
        uniform sampler2D uSrc;
        uniform vec2 uDelta;
        
        varying vec2 texCoord;
        varying vec2 screenCoord;
        
        void main(void) {
            vec4 col = texture2D(uSrc, texCoord);
            gl_FragColor = vec4(col.rgb * 2.0 - vec3(0.5), 1.0);
        }
        </script>
    <script id="fx_dirblur_r4_fsh" type="x-shader/x_fragment">
        #ifdef GL_ES
        //precision mediump float;
        precision highp float;
        #endif
        uniform sampler2D uSrc;
        uniform vec2 uDelta;
        uniform vec4 uBlurDir; //dir(x, y), stride(z, w)
        
        varying vec2 texCoord;
        varying vec2 screenCoord;
        
        void main(void) {
            vec4 col = texture2D(uSrc, texCoord);
            col = col + texture2D(uSrc, texCoord + uBlurDir.xy * uDelta);
            col = col + texture2D(uSrc, texCoord - uBlurDir.xy * uDelta);
            col = col + texture2D(uSrc, texCoord + (uBlurDir.xy + uBlurDir.zw) * uDelta);
            col = col + texture2D(uSrc, texCoord - (uBlurDir.xy + uBlurDir.zw) * uDelta);
            gl_FragColor = col / 5.0;
        }
        </script>
    <!-- effect fragment shader template -->
    <script id="fx_common_fsh" type="x-shader/x_fragment">
        #ifdef GL_ES
        //precision mediump float;
        precision highp float;
        #endif
        uniform sampler2D uSrc;
        uniform vec2 uDelta;
        
        varying vec2 texCoord;
        varying vec2 screenCoord;
        
        void main(void) {
            gl_FragColor = texture2D(uSrc, texCoord);
        }
        </script>
    <!-- post processing -->
    <script id="pp_final_vsh" type="x-shader/x_vertex">
        uniform vec3 uResolution;
        attribute vec2 aPosition;
        varying vec2 texCoord;
        varying vec2 screenCoord;
        void main(void) {
            gl_Position = vec4(aPosition, 0.0, 1.0);
            texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);
            screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);
        }
        </script>
    <script id="pp_final_fsh" type="x-shader/x_fragment">
        #ifdef GL_ES
        //precision mediump float;
        precision highp float;
        #endif
        uniform sampler2D uSrc;
        uniform sampler2D uBloom;
        uniform vec2 uDelta;
        varying vec2 texCoord;
        varying vec2 screenCoord;
        void main(void) {
            vec4 srccol = texture2D(uSrc, texCoord) * 2.0;
            vec4 bloomcol = texture2D(uBloom, texCoord);
            vec4 col;
            col = srccol + bloomcol * (vec4(1.0) + srccol);
            col *= smoothstep(1.0, 0.0, pow(length((texCoord - vec2(0.5)) * 2.0), 1.2) * 0.5);
            col = pow(col, vec4(0.45454545454545)); //(1.0 / 2.2)
        
            gl_FragColor = vec4(col.rgb, 1.0);
            gl_FragColor.a = 1.0;
        }
        </script>

    <!-- 显示提示的函数 -->
    <script>
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icon = document.createElement('i');
            icon.className = `toast-icon ri-${type === 'success' ? 'check-line' : 'close-line'}`;

            const messageSpan = document.createElement('span');
            messageSpan.className = 'toast-message';
            messageSpan.textContent = message;

            toast.appendChild(icon);
            toast.appendChild(messageSpan);
            toastContainer.appendChild(toast);

            // 3秒后自动移除
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 3000);
        }


        // 修改保存失败的提示
        function saveError(error) {
            showToast(`保存失败，原因: ${error}`, 'error');
        }
    </script>
</body>

</html>